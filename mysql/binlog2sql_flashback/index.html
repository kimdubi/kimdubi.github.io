<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>MySQL binlog2sql으로 flashback 복구하기 | kimDuBiA</title><meta name=keywords content="mysql,복구,운영"><meta name=description content="MySQL Flashback recovery MySQL에서는 flashback recovery가 아직 지원되지 않습니다.
그래서 MariaDB의 mysqlbinlog utility를 가져와서 사용하곤 했는데
binlog2sql 이라는 utility를 사용하면 MySQL에서도 flashback recovery를 할 수 있습니다.
binlog2sql  mysqlbinlog 처럼 binary log를 parsing 하는 유틸리티 MariaDB 에서는 제공되던 flashback 기능을 mysql 에서 binlog2sql을 통해 사용할 수 있음 schema-fileter 기능 (database,table) query-filter 기능 (dml-insert,update,delete) interval-filter 기능 (file,datetime) GTID 는 지원하지않음  install git clone https://github.com/danfengcao/binlog2sql.git cd binlog2sql pip install -r requirements.txt   mysql8 버전은 PyMySQL , mysql-replication 아래 버전 이상 사용해야함  PyMySQL==0."><meta name=author content="kimdubi"><link rel=canonical href=/mysql/binlog2sql_flashback/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.min.2dbef8664bbfb3e83a0a44fd4a8fc5010240dbcd1dbc1400753b928b497b8f5e.css integrity="sha256-Lb74Zku/s+g6CkT9So/FAQJA280dvBQAdTuSi0l7j14=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w=" onload=hljs.initHighlightingOnLoad();></script><link rel=icon href=%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.80.0"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme: rgb(29, 30, 32);--entry: rgb(46, 46, 51);--primary: rgb(218, 218, 219);--secondary: rgb(155, 156, 157);--tertiary: rgb(65, 66, 68);--content: rgb(196, 196, 197);--hljs-bg: rgb(46, 46, 51);--code-bg: rgb(55, 56, 62);--border: rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-123-45','auto');ga('send','pageview');}</script><meta property="og:title" content="MySQL binlog2sql으로 flashback 복구하기"><meta property="og:description" content="MySQL Flashback recovery MySQL에서는 flashback recovery가 아직 지원되지 않습니다.
그래서 MariaDB의 mysqlbinlog utility를 가져와서 사용하곤 했는데
binlog2sql 이라는 utility를 사용하면 MySQL에서도 flashback recovery를 할 수 있습니다.
binlog2sql  mysqlbinlog 처럼 binary log를 parsing 하는 유틸리티 MariaDB 에서는 제공되던 flashback 기능을 mysql 에서 binlog2sql을 통해 사용할 수 있음 schema-fileter 기능 (database,table) query-filter 기능 (dml-insert,update,delete) interval-filter 기능 (file,datetime) GTID 는 지원하지않음  install git clone https://github.com/danfengcao/binlog2sql.git cd binlog2sql pip install -r requirements.txt   mysql8 버전은 PyMySQL , mysql-replication 아래 버전 이상 사용해야함  PyMySQL==0."><meta property="og:type" content="article"><meta property="og:url" content="/mysql/binlog2sql_flashback/"><meta property="og:image" content="%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="mysql"><meta property="article:published_time" content="2021-10-04T10:28:20+09:00"><meta property="article:modified_time" content="2021-10-04T10:28:20+09:00"><meta property="og:site_name" content="kimDuBiA"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="MySQL binlog2sql으로 flashback 복구하기"><meta name=twitter:description content="MySQL Flashback recovery MySQL에서는 flashback recovery가 아직 지원되지 않습니다.
그래서 MariaDB의 mysqlbinlog utility를 가져와서 사용하곤 했는데
binlog2sql 이라는 utility를 사용하면 MySQL에서도 flashback recovery를 할 수 있습니다.
binlog2sql  mysqlbinlog 처럼 binary log를 parsing 하는 유틸리티 MariaDB 에서는 제공되던 flashback 기능을 mysql 에서 binlog2sql을 통해 사용할 수 있음 schema-fileter 기능 (database,table) query-filter 기능 (dml-insert,update,delete) interval-filter 기능 (file,datetime) GTID 는 지원하지않음  install git clone https://github.com/danfengcao/binlog2sql.git cd binlog2sql pip install -r requirements.txt   mysql8 버전은 PyMySQL , mysql-replication 아래 버전 이상 사용해야함  PyMySQL==0."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Mysqls","item":"/mysql/"},{"@type":"ListItem","position":3,"name":"MySQL binlog2sql으로 flashback 복구하기","item":"/mysql/binlog2sql_flashback/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"MySQL binlog2sql으로 flashback 복구하기","name":"MySQL binlog2sql으로 flashback 복구하기","description":"MySQL Flashback recovery MySQL에서는 flashback recovery가 아직 지원되지 않습니다.\n그래서 MariaDB의 mysqlbinlog utility를 가져와서 사용하곤 했는데\nbinlog2sql 이라는 utility를 사용하면 MySQL에서도 flashback recovery를 할 수 있습니다.\nbinlog2sql  mysqlbinlog 처럼 binary log를 parsing 하는 유틸리티 MariaDB 에서는 제공되던 flashback 기능을 mysql 에서 binlog2sql을 통해 사용할 수 있음 schema-fileter 기능 (database,table) query-filter 기능 (dml-insert,update,delete) interval-filter 기능 (file,datetime) GTID 는 지원하지않음  install git clone https://github.com/danfengcao/binlog2sql.git cd binlog2sql pip install -r requirements.txt   mysql8 버전은 PyMySQL , mysql-replication 아래 버전 이상 사용해야함  PyMySQL==0.","keywords":["mysql","복구","운영"],"articleBody":"MySQL Flashback recovery MySQL에서는 flashback recovery가 아직 지원되지 않습니다.\n그래서 MariaDB의 mysqlbinlog utility를 가져와서 사용하곤 했는데\nbinlog2sql 이라는 utility를 사용하면 MySQL에서도 flashback recovery를 할 수 있습니다.\nbinlog2sql  mysqlbinlog 처럼 binary log를 parsing 하는 유틸리티 MariaDB 에서는 제공되던 flashback 기능을 mysql 에서 binlog2sql을 통해 사용할 수 있음 schema-fileter 기능 (database,table) query-filter 기능 (dml-insert,update,delete) interval-filter 기능 (file,datetime) GTID 는 지원하지않음  install git clone https://github.com/danfengcao/binlog2sql.git cd binlog2sql pip install -r requirements.txt   mysql8 버전은 PyMySQL , mysql-replication 아래 버전 이상 사용해야함  PyMySQL==0.9.3 wheel==0.29.0 mysql-replication==0.21  필수 설정  ### my.cnf [mysqld] server_id = 100 #mandatory log_bin = mysql #mandatory max_binlog_size = 1G binlog_format = row #mandatory binlog_row_image = full #mandatory ### user privileges GRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO  binlog_format=MIXED 설정 시 flashback SQL 생성 불가  binary log 에서 SQL 추출  schema-filter  python /engn001/binlog2sql/binlog2sql/binlog2sql.py --user=root -p'qhdks123' -d testdb -tbinlog2sql --start-file mysql57-bin.000015 DELETE FROM `testdb`.`binlog2sql` WHERE `age`=19 AND `id`=1 AND `name`='kimdubi' LIMIT 1; #start1311203 end 1311711 time 2020-03-28 11:13:56 DELETE FROM `testdb`.`binlog2sql` WHERE `age`=29 AND `id`=2 AND `name`='kimdubi2' LIMIT 1; #start1311203 end 1311711 time 2020-03-28 11:13:56 DELETE FROM `testdb`.`binlog2sql` WHERE `age`=39 AND `id`=3 AND `name`='kimdubi3' LIMIT 1; #start1311203 end 1311711 time 2020-03-28 11:13:56 = -d , -t 옵션을 통해 특정 schema의 SQL 추출\n query-filter  python /engn001/binlog2sql/binlog2sql/binlog2sql.py --user=root -p'qhdks123' --start-filemysql57-bin.000010 --stop-never --only-dml --sql-type DELETE DELETE FROM `test`.`binlog2sql` WHERE `tcol22`='sed delectus sed velit nulla quidem.' AND`tcol23`='Way' AND `tcol20`='est laudantium distinctio rerum ipsa alias.' AND `tcol21`='ab nequeipsam minima dolorum sunt.' AND `tcol08`=1.20 AND `tcol09`='2020-03-28' AND `tcol24`='' AND`tcol25`='c' AND `tcol04`=1801160058 AND `tcol05`=3916589616287113937 AND `tcol06`=549458503723145 AND `tcol07`=0.939116 AND `tcol01`=5 AND `tcol02`=136 AND `tcol03`=172113 AND`tcol26`='red' AND `id`=1 AND `tcol27`=0.601999998092651 AND `tcol28`=0 AND`tcol19`='perspiciatis voluptatem asperiores impedit aut in.' AND `tcol18`='et voluptas et et.'AND `tcol13`=2019 AND `tcol12`='13:24:25' AND `tcol11`='2020-03-28 10:01:13' AND`tcol10`='2019-09-15 14:02:03' AND `tcol17`='nihil iusto odio eum ea voluptatibus et officiadolores.' AND `tcol16`='error sunt aut voluptatem eum cumque.' AND `tcol15`='He' AND`tcol14`='magni assumenda nemo placeat quo quam officia.' LIMIT 1; #start 1310403 end 1311172time 2020-03-28 10:52:57 = –only-dml , –sql-type 옵션을 통해 특정 dml SQL 추출\n interval-filter  python /engn001/binlog2sql/binlog2sql/binlog2sql.py --user=root -p'qhdks123' --start-filemysql57-bin.000004 --end-file mysql57-bin.000016 --start-datetime '2020-03-28 11:13:56'--stop-datetime '2020-03-29 11:00:00' INSERT INTO `testdb`.`binlog2sql`(`age`, `id`, `name`) VALUES (123, 12, 'kimubi1234'); #start1311203 end 1311711 time 2020-03-28 11:13:56 INSERT INTO `testdb`.`binlog2sql`(`age`, `id`, `name`) VALUES (12345, 11, 'kimdubi'); #start1311203 end 1311711 time 2020-03-28 11:13:56 INSERT INTO `testdb`.`binlog2sql`(`age`, `id`, `name`) VALUES (12345, 10, 'kimdubi'); #start1311203 end 1311711 time 2020-03-28 11:13:56 = file, datetime 옵션으로 특정 시간대 별 SQL 추출\n gtid는 지원안됨  python /engn001/binlog2sql/binlog2sql/binlog2sql.py --user=root -p'qhdks123'--start-position='8043f172-5d51-11ea-b0ab-0242ac120003:1' usage: binlog2sql.py [-h HOST] [-u USER] [-p [PASSWORD [PASSWORD ...]]] [-P PORT] [--start-file START_FILE] [--start-position START_POS] [--stop-file END_FILE] [--stop-position END_POS] [--start-datetime START_TIME] [--stop-datetime STOP_TIME] [--stop-never] [--help] [-d [DATABASES [DATABASES ...]]] [-t [TABLES [TABLES ...]]] [--only-dml] [--sql-type [SQL_TYPE [SQL_TYPE ...]]] [-K] [-B] [--back-interval BACK_INTERVAL] binlog2sql.py: error: argument --start-position/--start-pos: invalid int value:'8043f172-5d51-11ea-b0ab-0242ac120003:1' Flashback PITR 위에서 살펴본 SQL 추출 구문에서 –flashback 옵션 추가로 rollback 쿼리 추출할 수 있음\n update 장애  mysql update binlog2sql set tcol24='' ; Query OK, 1000 rows affected (0.04 sec) Rows matched: 1000 Changed: 1000 Warnings: 0  복구 대상 포지션 확인  BEGIN /*!*/; # at 291 . . . #200328 10:01:13 server id 33 end_log_pos 871299 CRC32 0xf0f3dd99 Xid = 1260 COMMIT/*!*/;  flashback query 추출  python /engn001/binlog2sql/binlog2sql/binlog2sql.py --user=root -p'qhdks123' \\ --start-file mysql57-bin.000015 --start-position=291 --stop-position=871299 --flashback flashback.sql  recovery SQL 반영  $ head -n 1 flashback.sql UPDATE `test`.`binlog2sql` SET `tcol22`='perferendis quibusdam iure sed!', `tcol23`='Sco',`tcol20`='sit excepturi dolorum et sunt ullam reiciendis ex.', `tcol21`='magni omnis inventoreest placeat sapiente!', `tcol08`=4.27, `tcol09`='2020-03-28', `tcol24`='Eric', `tcol25`='a',`tcol04`=734647498, `tcol05`=2996241080926269364, `tcol06`=6.63104915618896, `tcol07`=4.244445,`tcol01`=8, `tcol02`=139, `tcol03`=393191, `tcol26`='blue', `id`=1000, `tcol27`=0, `tcol28`=0,`tcol19`='ad est voluptates qui omnis quisquam.', `tcol18`='quia odit nulla fugiat eum!',`tcol13`=2019, `tcol12`='14:48:23', `tcol11`='2019-07-03 20:08:31', `tcol10`='2019-08-0604:04:28', `tcol17`='sed sit est repellendus aut necessitatibus ullam explicabo.',`tcol16`='ducimus minima officia aspernatur sit deserunt quo rerum sit.', `tcol15`='Br',`tcol14`='ut aliquam ea aut tempore magnam nemo voluptatem laudantium.' WHERE`tcol22`='perferendis quibusdam iure sed!' AND `tcol23`='Sco' AND `tcol20`='sit excepturi dolorumet sunt ullam reiciendis ex.' AND `tcol21`='magni omnis inventore est placeat sapiente!' AND`tcol08`=4.27 AND `tcol09`='2020-03-28' AND `tcol24`='' AND `tcol25`='a' AND `tcol04`=734647498AND `tcol05`=2996241080926269364 AND `tcol06`=6.63104915618896 AND `tcol07`=4.244445 AND`tcol01`=8 AND `tcol02`=139 AND `tcol03`=393191 AND `tcol26`='blue' AND `id`=1000 AND `tcol27`=0AND `tcol28`=0 AND `tcol19`='ad est voluptates qui omnis quisquam.' AND `tcol18`='quia odit nullafugiat eum!' AND `tcol13`=2019 AND `tcol12`='14:48:23' AND `tcol11`='2020-03-28 10:01:13' AND`tcol10`='2019-08-06 04:04:28' AND `tcol17`='sed sit est repellendus aut necessitatibus ullamexplicabo.' AND `tcol16`='ducimus minima officia aspernatur sit deserunt quo rerum sit.' AND`tcol15`='Br' AND `tcol14`='ut aliquam ea aut tempore magnam nemo voluptatem laudantium.' LIMIT1; #start 4 end 871268 time 2020-03-28 10:01:13 mysql ","wordCount":"710","inLanguage":"en","datePublished":"2021-10-04T10:28:20+09:00","dateModified":"2021-10-04T10:28:20+09:00","author":{"@type":"Person","name":"kimdubi"},"mainEntityOfPage":{"@type":"WebPage","@id":"/mysql/binlog2sql_flashback/"},"publisher":{"@type":"Organization","name":"kimDuBiA","logo":{"@type":"ImageObject","url":"%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><header class=header><nav class=nav><div class=logo><a href accesskey=h title="Home (Alt + H)">Home</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=/categories/ title=categories><span>categories</span></a></li><li><a href=/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href>Home</a>&nbsp;»&nbsp;<a href=/mysql/>Mysqls</a></div><h1 class=post-title>MySQL binlog2sql으로 flashback 복구하기</h1><div class=post-meta>October 4, 2021&nbsp;·&nbsp;4 min&nbsp;·&nbsp;kimdubi</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#mysql-flashback-recovery aria-label="MySQL Flashback recovery">MySQL Flashback recovery</a><ul><li><a href=#binlog2sql aria-label=binlog2sql>binlog2sql</a></li><li><a href=#install aria-label=install>install</a></li><li><a href=#binary-log-%ec%97%90%ec%84%9c-sql-%ec%b6%94%ec%b6%9c aria-label="binary log 에서 SQL 추출">binary log 에서 SQL 추출</a></li><li><a href=#flashback-pitr aria-label="Flashback PITR">Flashback PITR</a></li></ul></li></ul></div></details></div><div class=post-content><h2 id=mysql-flashback-recovery>MySQL Flashback recovery<a hidden class=anchor aria-hidden=true href=#mysql-flashback-recovery>#</a></h2><p>MySQL에서는 flashback recovery가 아직 지원되지 않습니다.<br>그래서 MariaDB의 mysqlbinlog utility를 가져와서 사용하곤 했는데<br>binlog2sql 이라는 utility를 사용하면 MySQL에서도 flashback recovery를 할 수 있습니다.</p><h3 id=binlog2sql>binlog2sql<a hidden class=anchor aria-hidden=true href=#binlog2sql>#</a></h3><ul><li>mysqlbinlog 처럼 binary log를 parsing 하는 유틸리티</li><li>MariaDB 에서는 제공되던 flashback 기능을 mysql 에서 binlog2sql을 통해 사용할 수 있음</li><li>schema-fileter 기능 (database,table)</li><li>query-filter 기능 (dml-insert,update,delete)</li><li>interval-filter 기능 (file,datetime)</li><li>GTID 는 지원하지않음</li></ul><h3 id=install>install<a hidden class=anchor aria-hidden=true href=#install>#</a></h3><pre><code>git clone https://github.com/danfengcao/binlog2sql.git
cd binlog2sql
pip install -r requirements.txt
</code></pre><ul><li>mysql8 버전은 PyMySQL , mysql-replication 아래 버전 이상 사용해야함</li></ul><pre><code>PyMySQL==0.9.3
wheel==0.29.0
mysql-replication==0.21
</code></pre><ul><li>필수 설정</li></ul><pre><code>### my.cnf
[mysqld]

server_id = 100            #mandatory
log_bin = mysql           #mandatory
max_binlog_size = 1G
binlog_format = row        #mandatory
binlog_row_image = full    #mandatory

### user privileges

GRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO 
</code></pre><ul><li>binlog_format=MIXED 설정 시 flashback SQL 생성 불가</li></ul><h3 id=binary-log-에서-sql-추출>binary log 에서 SQL 추출<a hidden class=anchor aria-hidden=true href=#binary-log-에서-sql-추출>#</a></h3><ul><li>schema-filter</li></ul><pre><code>python /engn001/binlog2sql/binlog2sql/binlog2sql.py --user=root -p'qhdks123' -d testdb -tbinlog2sql --start-file mysql57-bin.000015

DELETE FROM `testdb`.`binlog2sql` WHERE `age`=19 AND `id`=1 AND `name`='kimdubi' LIMIT 1; #start1311203 end 1311711 time 2020-03-28 11:13:56
DELETE FROM `testdb`.`binlog2sql` WHERE `age`=29 AND `id`=2 AND `name`='kimdubi2' LIMIT 1; #start1311203 end 1311711 time 2020-03-28 11:13:56
DELETE FROM `testdb`.`binlog2sql` WHERE `age`=39 AND `id`=3 AND `name`='kimdubi3' LIMIT 1; #start1311203 end 1311711 time 2020-03-28 11:13:56
</code></pre><p>=> -d , -t 옵션을 통해 특정 schema의 SQL 추출</p><ul><li>query-filter</li></ul><pre><code>python /engn001/binlog2sql/binlog2sql/binlog2sql.py --user=root -p'qhdks123' --start-filemysql57-bin.000010 --stop-never --only-dml --sql-type DELETE

DELETE FROM `test`.`binlog2sql` WHERE `tcol22`='sed delectus sed velit nulla quidem.' AND`tcol23`='Way' AND `tcol20`='est laudantium distinctio rerum ipsa alias.' AND `tcol21`='ab nequeipsam minima dolorum sunt.' AND `tcol08`=1.20 AND `tcol09`='2020-03-28' AND `tcol24`='' AND`tcol25`='c' AND `tcol04`=1801160058 AND `tcol05`=3916589616287113937 AND `tcol06`=549458503723145 AND `tcol07`=0.939116 AND `tcol01`=5 AND `tcol02`=136 AND `tcol03`=172113 AND`tcol26`='red' AND `id`=1 AND `tcol27`=0.601999998092651 AND `tcol28`=0 AND`tcol19`='perspiciatis voluptatem asperiores impedit aut in.' AND `tcol18`='et voluptas et et.'AND `tcol13`=2019 AND `tcol12`='13:24:25' AND `tcol11`='2020-03-28 10:01:13' AND`tcol10`='2019-09-15 14:02:03' AND `tcol17`='nihil iusto odio eum ea voluptatibus et officiadolores.' AND `tcol16`='error sunt aut voluptatem eum cumque.' AND `tcol15`='He' AND`tcol14`='magni assumenda nemo placeat quo quam officia.' LIMIT 1; #start 1310403 end 1311172time 2020-03-28 10:52:57
</code></pre><p>=> –only-dml , –sql-type 옵션을 통해 특정 dml SQL 추출</p><ul><li>interval-filter</li></ul><pre><code>python /engn001/binlog2sql/binlog2sql/binlog2sql.py --user=root -p'qhdks123' --start-filemysql57-bin.000004 --end-file mysql57-bin.000016 --start-datetime '2020-03-28 11:13:56'--stop-datetime '2020-03-29 11:00:00' 

INSERT INTO `testdb`.`binlog2sql`(`age`, `id`, `name`) VALUES (123, 12, 'kimubi1234'); #start1311203 end 1311711 time 2020-03-28 11:13:56
INSERT INTO `testdb`.`binlog2sql`(`age`, `id`, `name`) VALUES (12345, 11, 'kimdubi'); #start1311203 end 1311711 time 2020-03-28 11:13:56
INSERT INTO `testdb`.`binlog2sql`(`age`, `id`, `name`) VALUES (12345, 10, 'kimdubi'); #start1311203 end 1311711 time 2020-03-28 11:13:56
</code></pre><p>=> file, datetime 옵션으로 특정 시간대 별 SQL 추출</p><ul><li>gtid는 지원안됨</li></ul><pre><code>python /engn001/binlog2sql/binlog2sql/binlog2sql.py --user=root -p'qhdks123'--start-position='8043f172-5d51-11ea-b0ab-0242ac120003:1'

usage: binlog2sql.py [-h HOST] [-u USER] [-p [PASSWORD [PASSWORD ...]]]
                     [-P PORT] [--start-file START_FILE]
                     [--start-position START_POS] [--stop-file END_FILE]
                     [--stop-position END_POS] [--start-datetime START_TIME]
                     [--stop-datetime STOP_TIME] [--stop-never] [--help]
                     [-d [DATABASES [DATABASES ...]]]
                     [-t [TABLES [TABLES ...]]] [--only-dml]
                     [--sql-type [SQL_TYPE [SQL_TYPE ...]]] [-K] [-B]
                     [--back-interval BACK_INTERVAL]
binlog2sql.py: error: argument --start-position/--start-pos: invalid int value:'8043f172-5d51-11ea-b0ab-0242ac120003:1'
</code></pre><h3 id=flashback-pitr>Flashback PITR<a hidden class=anchor aria-hidden=true href=#flashback-pitr>#</a></h3><p>위에서 살펴본 SQL 추출 구문에서 –flashback 옵션 추가로 rollback 쿼리 추출할 수 있음</p><ul><li>update 장애</li></ul><pre><code>mysql&gt; update binlog2sql set tcol24='' ;
Query OK, 1000 rows affected (0.04 sec)
Rows matched: 1000  Changed: 1000  Warnings: 0
</code></pre><ul><li>복구 대상 포지션 확인</li></ul><pre><code>BEGIN
/*!*/;
# at 291
.
.
.
#200328 10:01:13 server id 33  end_log_pos 871299 CRC32 0xf0f3dd99      Xid = 1260
COMMIT/*!*/;
</code></pre><ul><li>flashback query 추출</li></ul><pre><code>python /engn001/binlog2sql/binlog2sql/binlog2sql.py --user=root -p'qhdks123' \
--start-file mysql57-bin.000015 --start-position=291 --stop-position=871299  --flashback &gt;flashback.sql
</code></pre><ul><li>recovery SQL 반영</li></ul><pre><code>$ head -n 1 flashback.sql

UPDATE `test`.`binlog2sql` SET `tcol22`='perferendis quibusdam iure sed!', `tcol23`='Sco',`tcol20`='sit excepturi dolorum et sunt ullam reiciendis ex.', `tcol21`='magni omnis inventoreest placeat sapiente!', `tcol08`=4.27, `tcol09`='2020-03-28', `tcol24`='Eric', `tcol25`='a',`tcol04`=734647498, `tcol05`=2996241080926269364, `tcol06`=6.63104915618896, `tcol07`=4.244445,`tcol01`=8, `tcol02`=139, `tcol03`=393191, `tcol26`='blue', `id`=1000, `tcol27`=0, `tcol28`=0,`tcol19`='ad est voluptates qui omnis quisquam.', `tcol18`='quia odit nulla fugiat eum!',`tcol13`=2019, `tcol12`='14:48:23', `tcol11`='2019-07-03 20:08:31', `tcol10`='2019-08-0604:04:28', `tcol17`='sed sit est repellendus aut necessitatibus ullam explicabo.',`tcol16`='ducimus minima officia aspernatur sit deserunt quo rerum sit.', `tcol15`='Br',`tcol14`='ut aliquam ea aut tempore magnam nemo voluptatem laudantium.' WHERE`tcol22`='perferendis quibusdam iure sed!' AND `tcol23`='Sco' AND `tcol20`='sit excepturi dolorumet sunt ullam reiciendis ex.' AND `tcol21`='magni omnis inventore est placeat sapiente!' AND`tcol08`=4.27 AND `tcol09`='2020-03-28' AND `tcol24`='' AND `tcol25`='a' AND `tcol04`=734647498AND `tcol05`=2996241080926269364 AND `tcol06`=6.63104915618896 AND `tcol07`=4.244445 AND`tcol01`=8 AND `tcol02`=139 AND `tcol03`=393191 AND `tcol26`='blue' AND `id`=1000 AND `tcol27`=0AND `tcol28`=0 AND `tcol19`='ad est voluptates qui omnis quisquam.' AND `tcol18`='quia odit nullafugiat eum!' AND `tcol13`=2019 AND `tcol12`='14:48:23' AND `tcol11`='2020-03-28 10:01:13' AND`tcol10`='2019-08-06 04:04:28' AND `tcol17`='sed sit est repellendus aut necessitatibus ullamexplicabo.' AND `tcol16`='ducimus minima officia aspernatur sit deserunt quo rerum sit.' AND`tcol15`='Br' AND `tcol14`='ut aliquam ea aut tempore magnam nemo voluptatem laudantium.' LIMIT1; #start 4 end 871268 time 2020-03-28 10:01:13


mysql &lt; flashback.sql
</code></pre></div><footer class=post-footer><ul class=post-tags><li><a href=/tags/mysql/>mysql</a></li><li><a href=/tags/%EB%B3%B5%EA%B5%AC/>복구</a></li><li><a href=/tags/%EC%9A%B4%EC%98%81/>운영</a></li></ul><nav class=paginav><a class=prev href=/mysql/partition_ddl/><span class=title>« Prev Page</span><br><span>MySQL / ORACLE PARTITION DDL 비교</span></a>
<a class=next href=/mysql/mysql_random_data/><span class=title>Next Page »</span><br><span>MySQL random data 준비하기</span></a></nav></footer><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")
return;var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;var disqus_shortname='disqus_nLxot7hRj6';dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2021 <a href>kimDuBiA</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById('menu')
menu.scrollLeft=localStorage.getItem("menu-scroll-position");menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft);}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script><script>document.querySelectorAll('pre > code').forEach((codeblock)=>{const container=codeblock.parentNode.parentNode;const copybutton=document.createElement('button');copybutton.classList.add('copy-code');copybutton.innerText='copy';function copyingDone(){copybutton.innerText='copied!';setTimeout(()=>{copybutton.innerText='copy';},2000);}
copybutton.addEventListener('click',(cb)=>{if('clipboard'in navigator){navigator.clipboard.writeText(codeblock.textContent);copyingDone();return;}
const range=document.createRange();range.selectNodeContents(codeblock);const selection=window.getSelection();selection.removeAllRanges();selection.addRange(range);try{document.execCommand('copy');copyingDone();}catch(e){};selection.removeRange(range);});if(container.classList.contains("highlight")){container.appendChild(copybutton);}else if(container.parentNode.firstChild==container){}else if(codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"){codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);}else{codeblock.parentNode.appendChild(copybutton);}});</script></body></html>
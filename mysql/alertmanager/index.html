<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>MySQL PMM alertmanager로 알람받기 | kimDuBiA</title><meta name=keywords content="mysql,PMM,monitoring"><meta name=description content="PMM alertmanager 로 알람받기 지난 글에서 MySQL 에서 생기는 일들을 모니터링 하는 PMM 구축 방법에 대해 소개해드렸습니다.
https://kimdubi.github.io/mysql/mysql_pmm/
그러나 모니터링 서버가 있어도 바로 이슈를 전달 받지 못하면 아무 소용이 없겠죠?
그래서 이번 글에서는 alertmanager 를 통해서 PMM에서 감지 된 이슈들을 sms으로 받는 방법에 대해 소개해드리겠습니다.
alertmanager 란? prometheus 를 통해 수집된 metric에서 사전에 설정해둔 alert rule 에 해당하는
이벤트가 발생하면 alertmanager 에게 알림이 가고
alertmanager는 이 알람을 email,slack, web-hook 등 다양한 방법으로 전달하는 역할을 합니다."><meta name=author content="kimdubi"><link rel=canonical href=/mysql/alertmanager/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.min.2dbef8664bbfb3e83a0a44fd4a8fc5010240dbcd1dbc1400753b928b497b8f5e.css integrity="sha256-Lb74Zku/s+g6CkT9So/FAQJA280dvBQAdTuSi0l7j14=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w=" onload=hljs.initHighlightingOnLoad();></script><link rel=icon href=%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.80.0"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme: rgb(29, 30, 32);--entry: rgb(46, 46, 51);--primary: rgb(218, 218, 219);--secondary: rgb(155, 156, 157);--tertiary: rgb(65, 66, 68);--content: rgb(196, 196, 197);--hljs-bg: rgb(46, 46, 51);--code-bg: rgb(55, 56, 62);--border: rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-123-45','auto');ga('send','pageview');}</script><meta property="og:title" content="MySQL PMM alertmanager로 알람받기"><meta property="og:description" content="PMM alertmanager 로 알람받기 지난 글에서 MySQL 에서 생기는 일들을 모니터링 하는 PMM 구축 방법에 대해 소개해드렸습니다.
https://kimdubi.github.io/mysql/mysql_pmm/
그러나 모니터링 서버가 있어도 바로 이슈를 전달 받지 못하면 아무 소용이 없겠죠?
그래서 이번 글에서는 alertmanager 를 통해서 PMM에서 감지 된 이슈들을 sms으로 받는 방법에 대해 소개해드리겠습니다.
alertmanager 란? prometheus 를 통해 수집된 metric에서 사전에 설정해둔 alert rule 에 해당하는
이벤트가 발생하면 alertmanager 에게 알림이 가고
alertmanager는 이 알람을 email,slack, web-hook 등 다양한 방법으로 전달하는 역할을 합니다."><meta property="og:type" content="article"><meta property="og:url" content="/mysql/alertmanager/"><meta property="og:image" content="%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="mysql"><meta property="article:published_time" content="2021-10-04T17:34:10+09:00"><meta property="article:modified_time" content="2021-10-04T17:34:10+09:00"><meta property="og:site_name" content="kimDuBiA"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="MySQL PMM alertmanager로 알람받기"><meta name=twitter:description content="PMM alertmanager 로 알람받기 지난 글에서 MySQL 에서 생기는 일들을 모니터링 하는 PMM 구축 방법에 대해 소개해드렸습니다.
https://kimdubi.github.io/mysql/mysql_pmm/
그러나 모니터링 서버가 있어도 바로 이슈를 전달 받지 못하면 아무 소용이 없겠죠?
그래서 이번 글에서는 alertmanager 를 통해서 PMM에서 감지 된 이슈들을 sms으로 받는 방법에 대해 소개해드리겠습니다.
alertmanager 란? prometheus 를 통해 수집된 metric에서 사전에 설정해둔 alert rule 에 해당하는
이벤트가 발생하면 alertmanager 에게 알림이 가고
alertmanager는 이 알람을 email,slack, web-hook 등 다양한 방법으로 전달하는 역할을 합니다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Mysqls","item":"/mysql/"},{"@type":"ListItem","position":3,"name":"MySQL PMM alertmanager로 알람받기","item":"/mysql/alertmanager/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"MySQL PMM alertmanager로 알람받기","name":"MySQL PMM alertmanager로 알람받기","description":"PMM alertmanager 로 알람받기 지난 글에서 MySQL 에서 생기는 일들을 모니터링 하는 PMM 구축 방법에 대해 소개해드렸습니다.\nhttps://kimdubi.github.io/mysql/mysql_pmm/\n그러나 모니터링 서버가 있어도 바로 이슈를 전달 받지 못하면 아무 소용이 없겠죠?\n그래서 이번 글에서는 alertmanager 를 통해서 PMM에서 감지 된 이슈들을 sms으로 받는 방법에 대해 소개해드리겠습니다.\nalertmanager 란? prometheus 를 통해 수집된 metric에서 사전에 설정해둔 alert rule 에 해당하는\n이벤트가 발생하면 alertmanager 에게 알림이 가고\nalertmanager는 이 알람을 email,slack, web-hook 등 다양한 방법으로 전달하는 역할을 합니다.","keywords":["mysql","PMM","monitoring"],"articleBody":"PMM alertmanager 로 알람받기 지난 글에서 MySQL 에서 생기는 일들을 모니터링 하는 PMM 구축 방법에 대해 소개해드렸습니다.\nhttps://kimdubi.github.io/mysql/mysql_pmm/\n그러나 모니터링 서버가 있어도 바로 이슈를 전달 받지 못하면 아무 소용이 없겠죠?\n그래서 이번 글에서는 alertmanager 를 통해서 PMM에서 감지 된 이슈들을 sms으로 받는 방법에 대해 소개해드리겠습니다.\nalertmanager 란? prometheus 를 통해 수집된 metric에서 사전에 설정해둔 alert rule 에 해당하는\n이벤트가 발생하면 alertmanager 에게 알림이 가고\nalertmanager는 이 알람을 email,slack, web-hook 등 다양한 방법으로 전달하는 역할을 합니다.\n사실 dashboard 역할을 하는 grafana도 4.x 버전대 부터는 이 알람기능이 추가 되었는데요\nUI상에서 정말 쉽게 알람 설정을 할 수 있다는 장점이 있지만\nhost 마다, metric 마다 일일이 설정해야 한다는 단점이 있어 모니터링 해야하는 대상이 많을 땐 역시 alertmanager 가 더 좋은 것 같습니다.\nalertmanager 설정   prometheus, grafana 설치한 서버에 설치했음\n  alertmanager 다운로드\n  wget [https://github.com/prometheus/alertmanager/releases/download/v0.5.1/alertmanager-0.5.1.linux-amd64.tar.gz](https://github.com/prometheus/alertmanager/releases/download/v0.5.1/alertmanager-0.5.1.linux-amd64.tar.gz) \u0026  prometheus.yml 설정  global: scrape_interval: 1m scrape_timeout : 1s ### 기존 설정에 아래 rule_files 위치 설정 추가 rule_files: - /engn001/alertmanager/alert.rules scrape_configs: - job_name: linux static_configs: - targets: ['172.17.0.3:9100'] . . .  alertmanager.yaml  $ vi /engn001/alertmanager-0.5.1.linux-amd64/alertmanager.yaml global: slack_api_url: 'https://hooks.slack.com/services/xxxxxxxx' route: receiver: 'slack id' group_by: ['alertname'] group_wait: 30s group_interval: 5m repeat_interval: 3h routes: - receiver: 'slack id' group_wait: 10s match_re: service: mysql receivers: - name: 'slack id' slack_configs: - channel: '#slack channel' = smtp , web-hook을 통한 slack, 핸드폰 문자 등 여러 방법으로 이벤트를 받아볼 수 있으나\nsmtp 메일은 거의 확인을 안할테고..\n핸드폰 문자는 webhook 서버를 따로 구축하고 sms 서비스를 이용하는 등 손이 많이 가서\n간단한 slack webhook을 사용해봤습니다.\nalertmanager 설정은 아래 링크 참고!!\nhttps://prometheus.io/docs/alerting/configuration/\nalert rule 설정 $ vi /engn001/alertmanager-0.5.1.linux-amd64/alert.rules ALERT LinuxMemory IF (round(((node_memory_MemTotal - (node_memory_MemFree + node_memory_Buffers + node_memory_Cached)) / node_memory_MemTotal) * 100)  90 ) and (node_memory_MemFree + node_memory_Buffers + node_memory_Cached  = 알람 받을 이벤트에 대한 rule 설정하는 부분\nprometheus 수집 데이터들만 가능하며 alertmanager, prometheus 버전에 따라 alert rule 설정 방법이 다를 수 있음\nalert rule 예제는 아래 참고!!\nhttps://awesome-prometheus-alerts.grep.to/rules\nalertmanager, prometheus 기동 /engn001/prometheus/prometheus -config.file=/engn001/prometheus/prometheus.yml -alertmanager.url=http://localhost:9093 \u0026 /engn001/alertmanager/alertmanager -config.file=/engn001/alertmanager/alertmanager.yaml \u0026  alertmanager 동작 확인   MySQL restarted 이벤트 발생\n  alertmanager 감지 후 알람 발송\n  slack에서 알람 수신 = alertmanager 감지 후 알람 발송 = slack 으로 알람 받음\n  ","wordCount":"367","inLanguage":"en","datePublished":"2021-10-04T17:34:10+09:00","dateModified":"2021-10-04T17:34:10+09:00","author":{"@type":"Person","name":"kimdubi"},"mainEntityOfPage":{"@type":"WebPage","@id":"/mysql/alertmanager/"},"publisher":{"@type":"Organization","name":"kimDuBiA","logo":{"@type":"ImageObject","url":"%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><header class=header><nav class=nav><div class=logo><a href accesskey=h title="Hi (Alt + H)">Hi</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=/ title=Home><span>Home</span></a></li><li><a href=/categories/ title=categories><span>categories</span></a></li><li><a href=/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href>Home</a>&nbsp;»&nbsp;<a href=/mysql/>Mysqls</a></div><h1 class=post-title>MySQL PMM alertmanager로 알람받기</h1><div class=post-meta>October 4, 2021&nbsp;·&nbsp;2 min&nbsp;·&nbsp;kimdubi</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#pmm-alertmanager-%eb%a1%9c-%ec%95%8c%eb%9e%8c%eb%b0%9b%ea%b8%b0 aria-label="PMM alertmanager 로 알람받기">PMM alertmanager 로 알람받기</a><ul><li><a href=#alertmanager-%eb%9e%80 aria-label="alertmanager 란?">alertmanager 란?</a></li><li><a href=#alertmanager-%ec%84%a4%ec%a0%95 aria-label="alertmanager 설정">alertmanager 설정</a></li><li><a href=#alert-rule-%ec%84%a4%ec%a0%95 aria-label="alert rule 설정">alert rule 설정</a></li><li><a href=#alertmanager-prometheus-%ea%b8%b0%eb%8f%99 aria-label="alertmanager, prometheus 기동">alertmanager, prometheus 기동</a></li><li><a href=#alertmanager-%eb%8f%99%ec%9e%91-%ed%99%95%ec%9d%b8 aria-label="alertmanager 동작 확인">alertmanager 동작 확인</a></li></ul></li></ul></div></details></div><div class=post-content><h2 id=pmm-alertmanager-로-알람받기>PMM alertmanager 로 알람받기<a hidden class=anchor aria-hidden=true href=#pmm-alertmanager-로-알람받기>#</a></h2><p>지난 글에서 MySQL 에서 생기는 일들을 모니터링 하는 PMM 구축 방법에 대해 소개해드렸습니다.<br><a href=https://kimdubi.github.io/mysql/mysql_pmm/>https://kimdubi.github.io/mysql/mysql_pmm/</a></p><p>그러나 모니터링 서버가 있어도 바로 이슈를 전달 받지 못하면 아무 소용이 없겠죠?<br>그래서 이번 글에서는 alertmanager 를 통해서 PMM에서 감지 된 이슈들을 sms으로 받는 방법에 대해 소개해드리겠습니다.</p><h3 id=alertmanager-란>alertmanager 란?<a hidden class=anchor aria-hidden=true href=#alertmanager-란>#</a></h3><p><img loading=lazy src=https://raw.githubusercontent.com/kimdubi/kimdubi.github.io/master/images/mysql/pmm_alert.png alt></p><p>prometheus 를 통해 수집된 metric에서 사전에 설정해둔 alert rule 에 해당하는<br>이벤트가 발생하면 alertmanager 에게 알림이 가고<br>alertmanager는 이 알람을 email,slack, web-hook 등 다양한 방법으로 전달하는 역할을 합니다.<br>사실 dashboard 역할을 하는 grafana도 4.x 버전대 부터는 이 알람기능이 추가 되었는데요<br>UI상에서 정말 쉽게 알람 설정을 할 수 있다는 장점이 있지만<br>host 마다, metric 마다 일일이 설정해야 한다는 단점이 있어 모니터링 해야하는 대상이 많을 땐 역시 alertmanager 가 더 좋은 것 같습니다.</p><h3 id=alertmanager-설정>alertmanager 설정<a hidden class=anchor aria-hidden=true href=#alertmanager-설정>#</a></h3><ul><li><p>prometheus, grafana 설치한 서버에 설치했음</p></li><li><p>alertmanager 다운로드</p></li></ul><pre><code>wget [https://github.com/prometheus/alertmanager/releases/download/v0.5.1/alertmanager-0.5.1.linux-amd64.tar.gz](https://github.com/prometheus/alertmanager/releases/download/v0.5.1/alertmanager-0.5.1.linux-amd64.tar.gz) &amp;
</code></pre><ul><li>prometheus.yml 설정</li></ul><pre><code>global:
  scrape_interval:     1m
  scrape_timeout :     1s
### 기존 설정에 아래 rule_files 위치 설정 추가  
rule_files:    
  - /engn001/alertmanager/alert.rules

scrape_configs:
  - job_name: linux
    static_configs:
      - targets: ['172.17.0.3:9100']
      .
      .
      .
</code></pre><ul><li>alertmanager.yaml</li></ul><pre><code>$ vi /engn001/alertmanager-0.5.1.linux-amd64/alertmanager.yaml

global:
  slack_api_url: 'https://hooks.slack.com/services/xxxxxxxx'

route:
  receiver: 'slack id'

  group_by: ['alertname']

  group_wait: 30s
  group_interval: 5m
  repeat_interval: 3h
  routes:
  - receiver: 'slack id'
    group_wait: 10s
    match_re:
      service: mysql

receivers:
- name: 'slack id'
  slack_configs:
  - channel: '#slack channel'
</code></pre><p>=> smtp , web-hook을 통한 slack, 핸드폰 문자 등 여러 방법으로 이벤트를 받아볼 수 있으나<br>smtp 메일은 거의 확인을 안할테고..<br>핸드폰 문자는 webhook 서버를 따로 구축하고 sms 서비스를 이용하는 등 손이 많이 가서<br>간단한 slack webhook을 사용해봤습니다.</p><p>alertmanager 설정은 아래 링크 참고!!<br><a href=https://prometheus.io/docs/alerting/configuration/>https://prometheus.io/docs/alerting/configuration/</a></p><h3 id=alert-rule-설정>alert rule 설정<a hidden class=anchor aria-hidden=true href=#alert-rule-설정>#</a></h3><pre><code>$ vi /engn001/alertmanager-0.5.1.linux-amd64/alert.rules

ALERT LinuxMemory
    IF (round(((node_memory_MemTotal - (node_memory_MemFree + node_memory_Buffers + node_memory_Cached)) / node_memory_MemTotal) * 100) &gt; 90 ) and (node_memory_MemFree + node_memory_Buffers + node_memory_Cached &lt; 1073741824)
    FOR 1m
    ANNOTATIONS {summary=&quot;Linux Memory Usage is at {{$value}}%&quot;}
.
.
.
ALERT MySQLRestarted
    IF  mysql_global_status_uptime  &lt; 300
    FOR 1m
    LABELS {severity=&quot;warning&quot;}
    ANNOTATIONS {summary=&quot;MySQL DB Server has been Restarted!!&quot;}
</code></pre><p>=> 알람 받을 이벤트에 대한 rule 설정하는 부분<br>prometheus 수집 데이터들만 가능하며 alertmanager, prometheus 버전에 따라 alert rule 설정 방법이 다를 수 있음<br>alert rule 예제는 아래 참고!!<br><a href=https://awesome-prometheus-alerts.grep.to/rules>https://awesome-prometheus-alerts.grep.to/rules</a></p><h3 id=alertmanager-prometheus-기동>alertmanager, prometheus 기동<a hidden class=anchor aria-hidden=true href=#alertmanager-prometheus-기동>#</a></h3><pre><code>/engn001/prometheus/prometheus -config.file=/engn001/prometheus/prometheus.yml -alertmanager.url=http://localhost:9093 &amp;
/engn001/alertmanager/alertmanager -config.file=/engn001/alertmanager/alertmanager.yaml &amp;
</code></pre><h3 id=alertmanager-동작-확인>alertmanager 동작 확인<a hidden class=anchor aria-hidden=true href=#alertmanager-동작-확인>#</a></h3><ul><li><p>MySQL restarted 이벤트 발생<br><img loading=lazy src=https://raw.githubusercontent.com/kimdubi/kimdubi.github.io/master/images/mysql/alert1.png alt></p></li><li><p>alertmanager 감지 후 알람 발송<br><img loading=lazy src=https://raw.githubusercontent.com/kimdubi/kimdubi.github.io/master/images/mysql/alert2.png alt></p></li><li><p>slack에서 알람 수신 => alertmanager 감지 후 알람 발송 <img loading=lazy src=https://raw.githubusercontent.com/kimdubi/kimdubi.github.io/master/images/mysql/alert3.png alt><br>=> slack 으로 알람 받음</p></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=/tags/mysql/>mysql</a></li><li><a href=/tags/pmm/>PMM</a></li><li><a href=/tags/monitoring/>monitoring</a></li></ul><nav class=paginav><a class=prev href=/mysql/in-list/><span class=title>« Prev Page</span><br><span>MySQL IN조건은 '='과 같을까</span></a>
<a class=next href=/mysql/replication_force_pk/><span class=title>Next Page »</span><br><span>MySQL8 replication REQUIRE_TABLE_PRIMARY_KEY_CHECK</span></a></nav></footer><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")
return;var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;var disqus_shortname='kimdubia';dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2022 <a href>kimDuBiA</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById('menu')
menu.scrollLeft=localStorage.getItem("menu-scroll-position");menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft);}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script><script>document.querySelectorAll('pre > code').forEach((codeblock)=>{const container=codeblock.parentNode.parentNode;const copybutton=document.createElement('button');copybutton.classList.add('copy-code');copybutton.innerText='copy';function copyingDone(){copybutton.innerText='copied!';setTimeout(()=>{copybutton.innerText='copy';},2000);}
copybutton.addEventListener('click',(cb)=>{if('clipboard'in navigator){navigator.clipboard.writeText(codeblock.textContent);copyingDone();return;}
const range=document.createRange();range.selectNodeContents(codeblock);const selection=window.getSelection();selection.removeAllRanges();selection.addRange(range);try{document.execCommand('copy');copyingDone();}catch(e){};selection.removeRange(range);});if(container.classList.contains("highlight")){container.appendChild(copybutton);}else if(container.parentNode.firstChild==container){}else if(codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"){codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);}else{codeblock.parentNode.appendChild(copybutton);}});</script></body></html>
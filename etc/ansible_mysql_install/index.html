<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Ansible ROLE 사용하여 MySQL 설치 | kimDuBiA</title><meta name=keywords content="ansible,mysql"><meta name=description content="ansible은 코드 재사용성, 클린 코드를 위해 “ROLE” 이라는 표준화 된 구성 기능을 제공합니다.
사용하기 어렵지만 그만큼 간결하게 원하는 작업들을 정의할 수 있는데요
이 ROLE을 사용하여 MySQL을 설치하는 ansible task를 정의해보겠습니다.
ansible role 생성 [root@8429d3d8f01b roles]# ansible-galaxy init mysql - Role mysql was created successfully [root@8429d3d8f01b roles]# tree mysql mysql |-- README.md |-- defaults | `-- main.yml |-- files |-- handlers | `-- main.yml |-- meta | `-- main.yml |-- tasks | `-- main."><meta name=author content="kimdubi"><link rel=canonical href=/etc/ansible_mysql_install/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.min.2dbef8664bbfb3e83a0a44fd4a8fc5010240dbcd1dbc1400753b928b497b8f5e.css integrity="sha256-Lb74Zku/s+g6CkT9So/FAQJA280dvBQAdTuSi0l7j14=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w=" onload=hljs.initHighlightingOnLoad();></script><link rel=icon href=%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.80.0"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme: rgb(29, 30, 32);--entry: rgb(46, 46, 51);--primary: rgb(218, 218, 219);--secondary: rgb(155, 156, 157);--tertiary: rgb(65, 66, 68);--content: rgb(196, 196, 197);--hljs-bg: rgb(46, 46, 51);--code-bg: rgb(55, 56, 62);--border: rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-123-45','auto');ga('send','pageview');}</script><meta property="og:title" content="Ansible ROLE 사용하여 MySQL 설치"><meta property="og:description" content="ansible은 코드 재사용성, 클린 코드를 위해 “ROLE” 이라는 표준화 된 구성 기능을 제공합니다.
사용하기 어렵지만 그만큼 간결하게 원하는 작업들을 정의할 수 있는데요
이 ROLE을 사용하여 MySQL을 설치하는 ansible task를 정의해보겠습니다.
ansible role 생성 [root@8429d3d8f01b roles]# ansible-galaxy init mysql - Role mysql was created successfully [root@8429d3d8f01b roles]# tree mysql mysql |-- README.md |-- defaults | `-- main.yml |-- files |-- handlers | `-- main.yml |-- meta | `-- main.yml |-- tasks | `-- main."><meta property="og:type" content="article"><meta property="og:url" content="/etc/ansible_mysql_install/"><meta property="og:image" content="%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="etc"><meta property="article:published_time" content="2021-10-06T21:41:20+09:00"><meta property="article:modified_time" content="2021-10-06T21:41:20+09:00"><meta property="og:site_name" content="kimDuBiA"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Ansible ROLE 사용하여 MySQL 설치"><meta name=twitter:description content="ansible은 코드 재사용성, 클린 코드를 위해 “ROLE” 이라는 표준화 된 구성 기능을 제공합니다.
사용하기 어렵지만 그만큼 간결하게 원하는 작업들을 정의할 수 있는데요
이 ROLE을 사용하여 MySQL을 설치하는 ansible task를 정의해보겠습니다.
ansible role 생성 [root@8429d3d8f01b roles]# ansible-galaxy init mysql - Role mysql was created successfully [root@8429d3d8f01b roles]# tree mysql mysql |-- README.md |-- defaults | `-- main.yml |-- files |-- handlers | `-- main.yml |-- meta | `-- main.yml |-- tasks | `-- main."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Etcs","item":"/etc/"},{"@type":"ListItem","position":3,"name":"Ansible ROLE 사용하여 MySQL 설치","item":"/etc/ansible_mysql_install/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Ansible ROLE 사용하여 MySQL 설치","name":"Ansible ROLE 사용하여 MySQL 설치","description":"ansible은 코드 재사용성, 클린 코드를 위해 “ROLE” 이라는 표준화 된 구성 기능을 제공합니다.\n사용하기 어렵지만 그만큼 간결하게 원하는 작업들을 정의할 수 있는데요\n이 ROLE을 사용하여 MySQL을 설치하는 ansible task를 정의해보겠습니다.\nansible role 생성 [root@8429d3d8f01b roles]# ansible-galaxy init mysql - Role mysql was created successfully [root@8429d3d8f01b roles]# tree mysql mysql |-- README.md |-- defaults | `-- main.yml |-- files |-- handlers | `-- main.yml |-- meta | `-- main.yml |-- tasks | `-- main.","keywords":["ansible","mysql"],"articleBody":" ansible은 코드 재사용성, 클린 코드를 위해 “ROLE” 이라는 표준화 된 구성 기능을 제공합니다.\n사용하기 어렵지만 그만큼 간결하게 원하는 작업들을 정의할 수 있는데요\n이 ROLE을 사용하여 MySQL을 설치하는 ansible task를 정의해보겠습니다.\nansible role 생성 [root@8429d3d8f01b roles]# ansible-galaxy init mysql - Role mysql was created successfully [root@8429d3d8f01b roles]# tree mysql mysql |-- README.md |-- defaults | `-- main.yml |-- files |-- handlers | `-- main.yml |-- meta | `-- main.yml |-- tasks | `-- main.yml |-- templates |-- tests | |-- inventory | `-- test.yml `-- vars `-- main.yml 8 directories, 8 files   defaults – 공통으로 사용할 변수 설정 files – target 으로 배포할 file, 주로 설치파일 handlers – task의 작업이 성공했을 때 호출되는 작업,ex) service start mysql meta - role에 대한 meta data, role 간 의존성 정의 tasks – 해당 ROLE에 의해 수행 될 task 정의 templates : role 배포 시 수정이 필요한 파일 템플릿, my.cnf 같은것 vars : 변수 설정, defaults 보다 우선순위가 높음  install playbook 생성 $ vi roles/install_db.yaml --- - hosts: install become: yes vars_files: - vars/main.yml tasks: - include: tasks/install.yml handlers: - include: handlers/main.yml  playbook에서 사용할 변수 설정 (vars) $ vi roles/mysql/vars/main.yml --- # vars file for mysql mysql_collation: utf8mb4_general_ci mysql_encoding: utf8mb4 mysql_bind_address: 0.0.0.0 mysql_max_connections: 1000 mysql_root_password: qhdks123 mysql_user_db_name: ansible mysql_user: ansible mysql_user_password: qhdks123 BufferPoolPct: 0.6  install task 설정 $ vi roles/mysql/tasks/install.yml --- - name: install epel-release action: \"{{ ansible_pkg_mgr }} name=epel-release state=latest\" - name: install mysql server action: \"{{ ansible_pkg_mgr }} name=mariadb-server state=present\" - name: install python mysql support library action: \"{{ ansible_pkg_mgr }} name=MySQL-python state=latest\" - name: set innodb_buffer size set_fact: buffer_pool_size: \"{{ (ansible_memtotal_mb * BufferPoolPct) | int }}\" - name: copy my.cnf template: src=my.cnf.j2 dest=/etc/my.cnf mode=0600 notify: - start mysql handlers: - include: handlers/main.yml - name: update mysql root password mysql_user: login_user: root login_password: \"{{ mysql_root_password }}\" name: root host: \"{{ item }}\" password: \"{{ mysql_root_password }}\" check_implicit_admin: yes priv: \"*.*:ALL,GRANT\" with_items: - \"{{ ansible_hostname }}\" - 127.0.0.1 - ::1 - localhost - name: remove test db mysql_db: login_user: root login_password: \"{{ mysql_root_password }}\" db: test state: absent - name: create a new db mysql_db: login_user: root login_password: \"{{ mysql_root_password }}\" name: \"{{ mysql_user_db_name }}\" collation: \"{{ mysql_collation }}\" encoding: \"{{ mysql_encoding }}\" state: present - name: delete anonymouse user mysql_user: login_user: root login_password: \"{{ mysql_root_password }}\" name: \"\" host_all: yes state: absent - name: create a new user mysql_user: login_user: root login_password: \"{{ mysql_root_password }}\" name: \"{{ mysql_user }}\" password: \"{{ mysql_user_password }}\" priv: \"{{ mysql_user_db_name }}.*:ALL,GRANT\" host: \"%\" state: present  = 설치 서버 마다 메모리가 다르고 서버 메모리의 60%를 innodb_buffer size로 설정하기로 했을때\nset_fact 모듈로 buffer_pool_size 변수 설정 후\ntemplate 의 my.cnf.j2 에서 해당 변수를 innodb_buffer_size 에 설정하도록함\nhandler 생성 --- - name: start mysql systemd: name: mariadb state: started  = 위의 tasks 에서 copy my.cnf 완료 후 , notify 를 통해 handler 호출\n배포할 file template 설정 vi roles/mysql/templates/my.cnf.j2 [client] port = 3306 socket = /var/run/mysqld/mysqld.sock [mysqld_safe] socket = /var/run/mysqld/mysqld.sock nice = 0 [mysqld] user = mysql pid-file = /var/run/mysqld/mysqld.pid socket = /var/run/mysqld/mysqld.sock port = 3306 basedir = /usr datadir = /var/lib/mysql tmpdir = /tmp lc_messages_dir = /usr/share/mysql lc_messages = en_US skip-external-locking bind-address = {{ mysql_bind_address }} max_connections = {{ mysql_max_connections }} connect_timeout = 5 wait_timeout = 600 max_allowed_packet = 16M thread_cache_size = 128 sort_buffer_size = 4M bulk_insert_buffer_size = 16M tmp_table_size = 32M max_heap_table_size = 32M # * InnoDB default_storage_engine = InnoDB # you can't just change log file size, requires special procedure #innodb_log_file_size = 50M innodb_buffer_pool_size = {{ buffer_pool_size | int }}M innodb_log_buffer_size = 8M innodb_file_per_table = 1 innodb_open_files = 400 innodb_io_capacity = 400 innodb_flush_method = O_DIRECT  playbook 수행 [root@8429d3d8f01b mysql]# ansible-playbook mysql_install.yaml PLAY [install] ************************* TASK [Gathering Facts] ***************** ok: [172.18.0.7] TASK [install epel-release] ************ ok: [172.18.0.7] TASK [install mysql server] ************ ok: [172.18.0.7] TASK [install python mysql support library] ************************* ok: [172.18.0.7] TASK [set innodb_buffer size] **************** ok: [172.18.0.7] TASK [copy my.cnf] **************************** ok: [172.18.0.7] TASK [start mysql server] ************** changed: [172.18.0.7] TASK [update mysql root password] ****** changed: [172.18.0.7] = (item=19ae1de8bfb1) changed: [172.18.0.7] = (item=127.0.0.1) changed: [172.18.0.7] = (item=::1) changed: [172.18.0.7] = (item=localhost) [WARNING]: Module did not set no_log for update_password TASK [remove test db] ****************** changed: [172.18.0.7] TASK [create a new db] ***************** changed: [172.18.0.7] TASK [delete anonymouse user] ********** changed: [172.18.0.7] TASK [create a new user] *************** changed: [172.18.0.7] PLAY RECAP ***************************** 172.18.0.7 : ok=12 changed=6 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 [root@19ae1de8bfb1 ~]# mysql -uroot -p -S /var/lib/mysql/mysql.sock Enter password: Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 10 Server version: 5.5.65-MariaDB MariaDB Server Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. MariaDB [(none)] show databases; +--------------------+ | Database | +--------------------+ | information_schema | | ansible | | mysql | | performance_schema | +--------------------+ 4 rows in set (0.01 sec) MariaDB [(none)] select user,host from mysql.user; +---------+--------------+ | user | host | +---------+--------------+ | ansible | % | | root | 127.0.0.1 | | root | 19ae1de8bfb1 | | root | ::1 | | root | localhost | +---------+--------------+ 5 rows in set (0.00 sec)  ","wordCount":"844","inLanguage":"en","datePublished":"2021-10-06T21:41:20+09:00","dateModified":"2021-10-06T21:41:20+09:00","author":{"@type":"Person","name":"kimdubi"},"mainEntityOfPage":{"@type":"WebPage","@id":"/etc/ansible_mysql_install/"},"publisher":{"@type":"Organization","name":"kimDuBiA","logo":{"@type":"ImageObject","url":"%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><header class=header><nav class=nav><div class=logo><a href accesskey=h title="Hi (Alt + H)">Hi</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=/ title=Home><span>Home</span></a></li><li><a href=/categories/ title=Categories><span>Categories</span></a></li><li><a href=/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href>Home</a>&nbsp;»&nbsp;<a href=/etc/>Etcs</a></div><h1 class=post-title>Ansible ROLE 사용하여 MySQL 설치</h1><div class=post-meta>October 6, 2021&nbsp;·&nbsp;4 min&nbsp;·&nbsp;kimdubi</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#ansible-role-%ec%83%9d%ec%84%b1 aria-label="ansible role 생성">ansible role 생성</a><ul><li><a href=#install-playbook-%ec%83%9d%ec%84%b1 aria-label="install playbook 생성">install playbook 생성</a></li><li><a href=#playbook%ec%97%90%ec%84%9c-%ec%82%ac%ec%9a%a9%ed%95%a0-%eb%b3%80%ec%88%98-%ec%84%a4%ec%a0%95-vars aria-label="playbook에서 사용할 변수 설정 (vars)">playbook에서 사용할 변수 설정 (vars)</a></li><li><a href=#install-task-%ec%84%a4%ec%a0%95 aria-label="install task 설정">install task 설정</a></li><li><a href=#handler-%ec%83%9d%ec%84%b1 aria-label="handler 생성">handler 생성</a></li><li><a href=#%eb%b0%b0%ed%8f%ac%ed%95%a0-file-template-%ec%84%a4%ec%a0%95 aria-label="배포할 file template 설정">배포할 file template 설정</a></li><li><a href=#playbook-%ec%88%98%ed%96%89 aria-label="playbook 수행">playbook 수행</a></li></ul></li></ul></div></details></div><div class=post-content><hr><p>ansible은 코드 재사용성, 클린 코드를 위해 “ROLE” 이라는 표준화 된 구성 기능을 제공합니다.<br>사용하기 어렵지만 그만큼 간결하게 원하는 작업들을 정의할 수 있는데요<br>이 ROLE을 사용하여 MySQL을 설치하는 ansible task를 정의해보겠습니다.</p><h2 id=ansible-role-생성>ansible role 생성<a hidden class=anchor aria-hidden=true href=#ansible-role-생성>#</a></h2><pre><code>[root@8429d3d8f01b roles]# ansible-galaxy init mysql
- Role mysql was created successfully

[root@8429d3d8f01b roles]# tree mysql
mysql
|-- README.md
|-- defaults
|   `-- main.yml
|-- files
|-- handlers
|   `-- main.yml
|-- meta
|   `-- main.yml
|-- tasks
|   `-- main.yml
|-- templates
|-- tests
|   |-- inventory
|   `-- test.yml
`-- vars
    `-- main.yml

8 directories, 8 files
</code></pre><ul><li>defaults – 공통으로 사용할 변수 설정</li><li>files – target 으로 배포할 file, 주로 설치파일</li><li>handlers – task의 작업이 성공했을 때 호출되는 작업,ex) service start mysql</li><li>meta - role에 대한 meta data, role 간 의존성 정의</li><li>tasks – 해당 ROLE에 의해 수행 될 task 정의</li><li>templates : role 배포 시 수정이 필요한 파일 템플릿, my.cnf 같은것</li><li>vars : 변수 설정, defaults 보다 우선순위가 높음</li></ul><h3 id=install-playbook-생성>install playbook 생성<a hidden class=anchor aria-hidden=true href=#install-playbook-생성>#</a></h3><pre><code>$ vi roles/install_db.yaml

---
   - hosts: install
     become: yes
     vars_files:
        - vars/main.yml
     tasks:
        - include: tasks/install.yml
     handlers:
        - include: handlers/main.yml
</code></pre><h3 id=playbook에서-사용할-변수-설정-vars>playbook에서 사용할 변수 설정 (vars)<a hidden class=anchor aria-hidden=true href=#playbook에서-사용할-변수-설정-vars>#</a></h3><pre><code>$ vi roles/mysql/vars/main.yml

---
# vars file for mysql
mysql_collation: utf8mb4_general_ci
mysql_encoding: utf8mb4
mysql_bind_address: 0.0.0.0
mysql_max_connections: 1000
mysql_root_password: qhdks123
mysql_user_db_name: ansible
mysql_user: ansible
mysql_user_password: qhdks123
BufferPoolPct: 0.6
</code></pre><h3 id=install-task-설정>install task 설정<a hidden class=anchor aria-hidden=true href=#install-task-설정>#</a></h3><pre><code>$ vi roles/mysql/tasks/install.yml

---
    - name: install epel-release
      action: &quot;{{ ansible_pkg_mgr }} name=epel-release state=latest&quot;
    - name: install mysql server
      action: &quot;{{ ansible_pkg_mgr }} name=mariadb-server state=present&quot;
    - name: install python mysql support library
      action: &quot;{{ ansible_pkg_mgr }} name=MySQL-python state=latest&quot;
    - name: set innodb_buffer size
      set_fact: 
        buffer_pool_size: &quot;{{ (ansible_memtotal_mb * BufferPoolPct) | int }}&quot;
    - name: copy my.cnf
      template:
        src=my.cnf.j2 
        dest=/etc/my.cnf 
        mode=0600
      notify: 
        - start mysql
      handlers:
        - include: handlers/main.yml  
    - name: update mysql root password
      mysql_user:
         login_user: root
         login_password: &quot;{{ mysql_root_password }}&quot;
         name: root
         host: &quot;{{ item }}&quot;
         password: &quot;{{ mysql_root_password }}&quot;
         check_implicit_admin: yes
         priv: &quot;*.*:ALL,GRANT&quot;
      with_items:
         - &quot;{{ ansible_hostname }}&quot;
         - 127.0.0.1
         - ::1
         - localhost
    - name: remove test db
      mysql_db:
          login_user: root
          login_password: &quot;{{ mysql_root_password }}&quot;
          db: test
          state: absent
    - name: create a new db
      mysql_db:
          login_user: root
          login_password: &quot;{{ mysql_root_password }}&quot;
          name: &quot;{{ mysql_user_db_name }}&quot;
          collation: &quot;{{ mysql_collation }}&quot;
          encoding: &quot;{{ mysql_encoding }}&quot;
          state: present
    - name: delete anonymouse user
      mysql_user:
          login_user: root
          login_password: &quot;{{ mysql_root_password }}&quot;
          name: &quot;&quot;
          host_all: yes
          state: absent
    - name: create a new user
      mysql_user:
          login_user: root
          login_password: &quot;{{ mysql_root_password }}&quot;
          name: &quot;{{ mysql_user }}&quot;
          password: &quot;{{ mysql_user_password }}&quot;
          priv: &quot;{{ mysql_user_db_name }}.*:ALL,GRANT&quot;
          host: &quot;%&quot;
          state: present
</code></pre><p>=> 설치 서버 마다 메모리가 다르고 서버 메모리의 60%를 innodb_buffer size로 설정하기로 했을때<br>set_fact 모듈로 buffer_pool_size 변수 설정 후<br>template 의 my.cnf.j2 에서 해당 변수를 innodb_buffer_size 에 설정하도록함</p><h3 id=handler-생성>handler 생성<a hidden class=anchor aria-hidden=true href=#handler-생성>#</a></h3><pre><code>---
    - name: start mysql
      systemd: 
        name: mariadb
        state: started
</code></pre><p>=> 위의 tasks 에서 copy my.cnf 완료 후 , notify 를 통해 handler 호출</p><h3 id=배포할-file-template-설정>배포할 file template 설정<a hidden class=anchor aria-hidden=true href=#배포할-file-template-설정>#</a></h3><pre><code>vi roles/mysql/templates/my.cnf.j2

[client]
port    = 3306
socket    = /var/run/mysqld/mysqld.sock
[mysqld_safe]
socket    = /var/run/mysqld/mysqld.sock
nice    = 0
[mysqld]
user    = mysql
pid-file  = /var/run/mysqld/mysqld.pid
socket    = /var/run/mysqld/mysqld.sock
port    = 3306
basedir    = /usr
datadir    = /var/lib/mysql
tmpdir    = /tmp
lc_messages_dir  = /usr/share/mysql
lc_messages  = en_US
skip-external-locking
bind-address    = {{ mysql_bind_address }}
max_connections    = {{ mysql_max_connections }}
connect_timeout    = 5
wait_timeout    = 600
max_allowed_packet  = 16M
thread_cache_size       = 128
sort_buffer_size  = 4M
bulk_insert_buffer_size  = 16M
tmp_table_size    = 32M
max_heap_table_size  = 32M
# * InnoDB
default_storage_engine  = InnoDB
# you can't just change log file size, requires special procedure
#innodb_log_file_size  = 50M
innodb_buffer_pool_size  = {{ buffer_pool_size | int }}M
innodb_log_buffer_size  = 8M
innodb_file_per_table  = 1
innodb_open_files  = 400
innodb_io_capacity  = 400
innodb_flush_method  = O_DIRECT
</code></pre><h3 id=playbook-수행>playbook 수행<a hidden class=anchor aria-hidden=true href=#playbook-수행>#</a></h3><pre><code>[root@8429d3d8f01b mysql]# ansible-playbook mysql_install.yaml

PLAY [install] *************************

TASK [Gathering Facts] *****************
ok: [172.18.0.7]

TASK [install epel-release] ************
ok: [172.18.0.7]

TASK [install mysql server] ************
ok: [172.18.0.7]

TASK [install python mysql support library] *************************
ok: [172.18.0.7]

TASK [set innodb_buffer size] ****************
ok: [172.18.0.7]

TASK [copy my.cnf] ****************************
ok: [172.18.0.7]

TASK [start mysql server] **************
changed: [172.18.0.7]

TASK [update mysql root password] ******
changed: [172.18.0.7] =&gt; (item=19ae1de8bfb1)
changed: [172.18.0.7] =&gt; (item=127.0.0.1)
changed: [172.18.0.7] =&gt; (item=::1)
changed: [172.18.0.7] =&gt; (item=localhost)
[WARNING]: Module did not set no_log for update_password

TASK [remove test db] ******************
changed: [172.18.0.7]

TASK [create a new db] *****************
changed: [172.18.0.7]

TASK [delete anonymouse user] **********
changed: [172.18.0.7]

TASK [create a new user] ***************
changed: [172.18.0.7]

PLAY RECAP *****************************
172.18.0.7                 : ok=12   changed=6    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0




[root@19ae1de8bfb1 ~]# mysql -uroot -p -S /var/lib/mysql/mysql.sock
Enter password:
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 10
Server version: 5.5.65-MariaDB MariaDB Server

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.


MariaDB [(none)]&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| ansible            |
| mysql              |
| performance_schema |
+--------------------+
4 rows in set (0.01 sec)

MariaDB [(none)]&gt; select user,host from mysql.user;
+---------+--------------+
| user    | host         |
+---------+--------------+
| ansible | %            |
| root    | 127.0.0.1    |
| root    | 19ae1de8bfb1 |
| root    | ::1          |
| root    | localhost    |
+---------+--------------+
5 rows in set (0.00 sec)
</code></pre></div><footer class=post-footer><ul class=post-tags><li><a href=/tags/ansible/>ansible</a></li><li><a href=/tags/mysql/>mysql</a></li></ul></footer><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")
return;var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;var disqus_shortname='kimdubia';dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2024 <a href>kimDuBiA</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById('menu')
menu.scrollLeft=localStorage.getItem("menu-scroll-position");menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft);}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script><script>document.querySelectorAll('pre > code').forEach((codeblock)=>{const container=codeblock.parentNode.parentNode;const copybutton=document.createElement('button');copybutton.classList.add('copy-code');copybutton.innerText='copy';function copyingDone(){copybutton.innerText='copied!';setTimeout(()=>{copybutton.innerText='copy';},2000);}
copybutton.addEventListener('click',(cb)=>{if('clipboard'in navigator){navigator.clipboard.writeText(codeblock.textContent);copyingDone();return;}
const range=document.createRange();range.selectNodeContents(codeblock);const selection=window.getSelection();selection.removeAllRanges();selection.addRange(range);try{document.execCommand('copy');copyingDone();}catch(e){};selection.removeRange(range);});if(container.classList.contains("highlight")){container.appendChild(copybutton);}else if(container.parentNode.firstChild==container){}else if(codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"){codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);}else{codeblock.parentNode.appendChild(copybutton);}});</script></body></html>
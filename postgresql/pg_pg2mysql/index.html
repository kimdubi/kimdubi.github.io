<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>PostgreSQL to MySQL Migration | kimDuBiA</title><meta name=keywords content="postgresql,mysql"><meta name=description content="MySQL을 PostgreSQL 로 이관하는 방법은 PostgreSQL에서 제공하는 기능인 pgloader 를 사용하면 오브젝트부터 데이터까지 쉽게 이관할 수 있지만
반대인 PostgreSQL -> MySQL 은 적당한 툴도 없고, 두 DB의 schema 개념도 달라 사전에 알아둬야 할 점이 많습니다.
이번에 이관했던 서비스를 예시로 PostgreSQL => MySQL 이관 방법을 정리해보았습니다.
PostgreSQL 과 MySQL schema 차이  PostgreSQL에서는 테이블의 집합이 schema ( 위 그림에서 public, myschema ) schema 의 집합이 database ( 위 그림에서 postgres , mydb ) 테이블의 집합 = schema 가 곧 논리 database 인 MySQL과는 개념이 다름 단 아래와 같이 DB 내에 사용하는 schema 가 단 하나일 땐 PostgreSQL database -> MySQL database 1:1 매핑이 가능함  amon=# \dn List of schemas Name | Owner --------------------+-------------- information_schema | testuser pg_catalog | testuser pg_toast | testuser pg_toast_temp_1 | testuser public | testuser (5 rows) => public 을 제외한 나머지 schema는 시스템 관련 스키마, pulic은 모든 schema가 접근 가능한 default schema test=# select count(*) from information_schema."><meta name=author content="kimdubi"><link rel=canonical href=/postgresql/pg_pg2mysql/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.min.2dbef8664bbfb3e83a0a44fd4a8fc5010240dbcd1dbc1400753b928b497b8f5e.css integrity="sha256-Lb74Zku/s+g6CkT9So/FAQJA280dvBQAdTuSi0l7j14=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w=" onload=hljs.initHighlightingOnLoad();></script><link rel=icon href=%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.80.0"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme: rgb(29, 30, 32);--entry: rgb(46, 46, 51);--primary: rgb(218, 218, 219);--secondary: rgb(155, 156, 157);--tertiary: rgb(65, 66, 68);--content: rgb(196, 196, 197);--hljs-bg: rgb(46, 46, 51);--code-bg: rgb(55, 56, 62);--border: rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-123-45','auto');ga('send','pageview');}</script><meta property="og:title" content="PostgreSQL to MySQL Migration"><meta property="og:description" content="MySQL을 PostgreSQL 로 이관하는 방법은 PostgreSQL에서 제공하는 기능인 pgloader 를 사용하면 오브젝트부터 데이터까지 쉽게 이관할 수 있지만
반대인 PostgreSQL -> MySQL 은 적당한 툴도 없고, 두 DB의 schema 개념도 달라 사전에 알아둬야 할 점이 많습니다.
이번에 이관했던 서비스를 예시로 PostgreSQL => MySQL 이관 방법을 정리해보았습니다.
PostgreSQL 과 MySQL schema 차이  PostgreSQL에서는 테이블의 집합이 schema ( 위 그림에서 public, myschema ) schema 의 집합이 database ( 위 그림에서 postgres , mydb ) 테이블의 집합 = schema 가 곧 논리 database 인 MySQL과는 개념이 다름 단 아래와 같이 DB 내에 사용하는 schema 가 단 하나일 땐 PostgreSQL database -> MySQL database 1:1 매핑이 가능함  amon=# \dn List of schemas Name | Owner --------------------+-------------- information_schema | testuser pg_catalog | testuser pg_toast | testuser pg_toast_temp_1 | testuser public | testuser (5 rows) => public 을 제외한 나머지 schema는 시스템 관련 스키마, pulic은 모든 schema가 접근 가능한 default schema test=# select count(*) from information_schema."><meta property="og:type" content="article"><meta property="og:url" content="/postgresql/pg_pg2mysql/"><meta property="og:image" content="%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="postgresql"><meta property="article:published_time" content="2021-10-05T23:38:34+09:00"><meta property="article:modified_time" content="2021-10-05T23:38:34+09:00"><meta property="og:site_name" content="kimDuBiA"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="PostgreSQL to MySQL Migration"><meta name=twitter:description content="MySQL을 PostgreSQL 로 이관하는 방법은 PostgreSQL에서 제공하는 기능인 pgloader 를 사용하면 오브젝트부터 데이터까지 쉽게 이관할 수 있지만
반대인 PostgreSQL -> MySQL 은 적당한 툴도 없고, 두 DB의 schema 개념도 달라 사전에 알아둬야 할 점이 많습니다.
이번에 이관했던 서비스를 예시로 PostgreSQL => MySQL 이관 방법을 정리해보았습니다.
PostgreSQL 과 MySQL schema 차이  PostgreSQL에서는 테이블의 집합이 schema ( 위 그림에서 public, myschema ) schema 의 집합이 database ( 위 그림에서 postgres , mydb ) 테이블의 집합 = schema 가 곧 논리 database 인 MySQL과는 개념이 다름 단 아래와 같이 DB 내에 사용하는 schema 가 단 하나일 땐 PostgreSQL database -> MySQL database 1:1 매핑이 가능함  amon=# \dn List of schemas Name | Owner --------------------+-------------- information_schema | testuser pg_catalog | testuser pg_toast | testuser pg_toast_temp_1 | testuser public | testuser (5 rows) => public 을 제외한 나머지 schema는 시스템 관련 스키마, pulic은 모든 schema가 접근 가능한 default schema test=# select count(*) from information_schema."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Postgresqls","item":"/postgresql/"},{"@type":"ListItem","position":3,"name":"PostgreSQL to MySQL Migration","item":"/postgresql/pg_pg2mysql/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"PostgreSQL to MySQL Migration","name":"PostgreSQL to MySQL Migration","description":"MySQL을 PostgreSQL 로 이관하는 방법은 PostgreSQL에서 제공하는 기능인 pgloader 를 사용하면 오브젝트부터 데이터까지 쉽게 이관할 수 있지만\n반대인 PostgreSQL -\u0026gt; MySQL 은 적당한 툴도 없고, 두 DB의 schema 개념도 달라 사전에 알아둬야 할 점이 많습니다.\n이번에 이관했던 서비스를 예시로 PostgreSQL =\u0026gt; MySQL 이관 방법을 정리해보았습니다.\nPostgreSQL 과 MySQL schema 차이  PostgreSQL에서는 테이블의 집합이 schema ( 위 그림에서 public, myschema ) schema 의 집합이 database ( 위 그림에서 postgres , mydb ) 테이블의 집합 = schema 가 곧 논리 database 인 MySQL과는 개념이 다름 단 아래와 같이 DB 내에 사용하는 schema 가 단 하나일 땐 PostgreSQL database -\u0026gt; MySQL database 1:1 매핑이 가능함  amon=# \\dn List of schemas Name | Owner --------------------+-------------- information_schema | testuser pg_catalog | testuser pg_toast | testuser pg_toast_temp_1 | testuser public | testuser (5 rows) =\u0026gt; public 을 제외한 나머지 schema는 시스템 관련 스키마, pulic은 모든 schema가 접근 가능한 default schema test=# select count(*) from information_schema.","keywords":["postgresql","mysql"],"articleBody":" MySQL을 PostgreSQL 로 이관하는 방법은 PostgreSQL에서 제공하는 기능인 pgloader 를 사용하면 오브젝트부터 데이터까지 쉽게 이관할 수 있지만\n반대인 PostgreSQL - MySQL 은 적당한 툴도 없고, 두 DB의 schema 개념도 달라 사전에 알아둬야 할 점이 많습니다.\n이번에 이관했던 서비스를 예시로 PostgreSQL = MySQL 이관 방법을 정리해보았습니다.\nPostgreSQL 과 MySQL schema 차이  PostgreSQL에서는 테이블의 집합이 schema ( 위 그림에서 public, myschema ) schema 의 집합이 database ( 위 그림에서 postgres , mydb ) 테이블의 집합 = schema 가 곧 논리 database 인 MySQL과는 개념이 다름 단 아래와 같이 DB 내에 사용하는 schema 가 단 하나일 땐 PostgreSQL database - MySQL database 1:1 매핑이 가능함  amon=# \\dn List of schemas Name | Owner --------------------+-------------- information_schema | testuser pg_catalog | testuser pg_toast | testuser pg_toast_temp_1 | testuser public | testuser (5 rows) = public 을 제외한 나머지 schema는 시스템 관련 스키마, pulic은 모든 schema가 접근 가능한 default schema test=# select count(*) from information_schema.tables where table_schema='public'; count ------- 100 (1 row) = 해당 서비스에서는 다른 서비스용 schema 를 생성하지 않고 기본 public schema에 오브젝트를 생성하였음\n이관대상 확인 database postgres=# \\l+ List of databases Name | Owner | Encoding | Collation | Ctype | Access privileges | Size | Tablespace | Description -----------+--------------+----------+------------+------------+-----------------------------------+---------+------------+--------------------------- test1 | testuser | UTF8 | en_US.UTF8 | en_US.UTF8 | | 13 MB | pg_default | test2 | testuser | UTF8 | en_US.UTF8 | en_US.UTF8 | | 172 MB | pg_default | : template0 | postres | UTF8 | en_US.UTF8 | en_US.UTF8 | =c/\"testuser\" | 5408 kB | pg_default | : \"testuser\"=CTc/\"testuser\" template1 | postgres | UTF8 | en_US.UTF8 | en_US.UTF8 | =c/\"testuser\" | 5408 kB | pg_default | default template database : \"testuser\"=CTc/\"testuser\"   이관 대상 PostgreSQL DB 서버 내에 여러 database 들이 존재하는 상황임 원래 개념대로라면 위의 database 하나하나가 MySQL의 DB instance 로 매핑되지만 아래와 같이 각 database 내에서 schema 를 public schema 하나만 사용하고 있어 PostgreSQL 과 MySQL 1:1 매핑이 가능함  schema test1=# \\dn List of schemas Name | Owner --------------------+-------------- information_schema | testuser pg_catalog | testuser pg_toast | testuser pg_toast_temp_1 | testuser public | testuser (5 rows) test1=# select count(*) from information_schema.tables where table_schema='public'; count ------- 100 (1 row) test1=# \\dn List of schemas Name | Owner --------------------+-------------- information_schema | testuser pg_catalog | testuser pg_toast | testuser pg_toast_temp_1 | testuser public | testuser (5 rows) test2=# select count(*) from information_schema.tables where table_schema='public'; count ------- 84 (1 row)  user postgres=# select * from pg_catalog.pg_roles; rolname | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcatupdate | rolcanlogin | rolconnlimit | rolpassword | rolvaliduntil | rolconfig | oid --------------+----------+------------+---------------+-------------+--------------+-------------+--------------+-------------+---------------+-----------+------- testuser | t | t | t | t | t | t | -1 | ******** | | | 10 . .  pg2mysql PostgreSQL dump 파일을 MySQL 쿼리로 변환해주는 툴로 더이상 개발되지 않아 실사용 하기위해 몇가지 부분을 추가하였음\npg2mysql 이슈 및 수정사항  테이블 정의 중 Constraint 부분을 의도적으로 생략하는 이슈  foreign , unique constraint 생성 구문 변환되도록 수정   Unique key가 일반인덱스로 생성 되는 이슈  Unique key로 생성되도록 수정   engine 변환 구문 오류  default로 InnoDB engine 으로 생성하도록 수정   메모리 제한 이슈  pg2mysql 프로그램이 사용할 수 있는 최대 메모리 limit 을 512MB로 제한   이관했던 서비스가 테이블, 컬럼을 모두 대문자로 사용하여 생성구문을 모두 대문자로 생성하도록 strtoupper 함수를 추가했음 소문자로 사용하는 경우 strtoupper 함수부분을 제거해야함 cidr, inet 컬럼 미지원  PostgreSQL에는 IP를 표현하는 cidr, inet 컬럼 타입이 있으나 MySQL에는 없음, 이부분은 MySQL에서 big int + inet_aton, inet_ation으로 구현할지 varchar 타입으로 전환할지 결정이 필요하여 수정하지 않았음. 참고로, varchar 로 전환시 order by 결과값이 inet 과는 다름   FK option  PostgreSQL에는 DEFERRABLE INITIALLY DEFERRED ( 제약조건을 트랜잭션 종료할 때 검사하는 설정) 같은 MySQL에서는 지원하지 않는 기능이 있음. 경우에 따라 fk 조건을 삭제하거나 트랜잭션 시작시에 set foreign_key_checks = 0 ; 설정을 주도록 개발팀과 협의가 필요하기 때문에 변환과정에서 생략하지 않고 포함하도록함    사용방법  php 설치  $ php --version PHP 5.3.3 (cli) (built: Mar 22 2017 12:27:09)  첨부파일의 pg2mysql tar 파일을 품  $ ls -ltr total 44 -rw-r--r-- 1 irteam irteam 15145 May 26 2006 gpl.txt -rw-r--r-- 1 irteam irteam 2370 Jul 21 2011 pg2mysql.php -rw-r--r-- 1 irteam irteam 1534 Jul 21 2011 pg2mysql_cli.php -rw-r--r-- 1 irteam irteam 2985 Jul 21 2011 README -rw-rw-r-- 1 irteam irteam 13204 Aug 10 20:44 pg2mysql.inc.php.org -rw-r--r-- 1 irteam irteam 13235 Aug 10 20:44 pg2mysql.inc.php  이관 대상 PostgreSQL dump 파일 준비  ### schema only pg_dump -p port -U username -S dbname --format p -f dbname_schema.sql ### data only, insert 구문으로 pg_dump -p port -U username -a dbname --inserts --format p -f dbname_data.sql ### schema+ data pg_dump -p port -U username dbname --inserts --format p -f dbname_full.sql  MySQL 쿼리로 변환  php pg2mysql_cli.php dbname_full.sql mysql_dbname.sql 데이터 검증 (count 확인)  PostgreSQL  #!/bin/bash database=database_name user=postgres echo \"Database : $database\" PGCOMMAND=\" psql -U $user -d $database -At -c \\\" SELECT table_name FROM information_schema.tables WHERE table_type='BASE TABLE' AND table_schema='public' \\\"\" TABLENAMES=$(export PGPASSWORD=패스워드; eval \"$PGCOMMAND\") for TABLENAME in $TABLENAMES; do PGCOMMAND=\" psql -U $user -d $database -At -c \\\" SELECT '$TABLENAME', count(*) FROM $TABLENAME \\\"\" eval \"$PGCOMMAND\" done  MySQL  #!/bin/bash database=database_name for name in `mys $database -B -e \"show tables\"`; do mys -B --vertical $database -e \"select count(*) as $name from $name\" | grep -v '^\\*' | replace \": \" \"|\" done  index count  # MySQL select table_name,count(distinct index_name) from information_schema.STATISTICS where index_schema='amon' group by 1 order by 1; # PostgreSQL select tablename,count(*) from pg_indexes where schemaname='public' group by 1 order by 1; = MySQL로 변환되면서 Auto-increment 컬럼이 PK 가 되기 때문에 MySQL 이 인덱스가 더 많을 수 있음\n","wordCount":"885","inLanguage":"en","datePublished":"2021-10-05T23:38:34+09:00","dateModified":"2021-10-05T23:38:34+09:00","author":{"@type":"Person","name":"kimdubi"},"mainEntityOfPage":{"@type":"WebPage","@id":"/postgresql/pg_pg2mysql/"},"publisher":{"@type":"Organization","name":"kimDuBiA","logo":{"@type":"ImageObject","url":"%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><header class=header><nav class=nav><div class=logo><a href accesskey=h title="Hi (Alt + H)">Hi</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=/ title=Home><span>Home</span></a></li><li><a href=/categories/ title=categories><span>categories</span></a></li><li><a href=/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href>Home</a>&nbsp;»&nbsp;<a href=/postgresql/>Postgresqls</a></div><h1 class=post-title>PostgreSQL to MySQL Migration</h1><div class=post-meta>October 5, 2021&nbsp;·&nbsp;5 min&nbsp;·&nbsp;kimdubi</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#postgresql-%ea%b3%bc-mysql-schema-%ec%b0%a8%ec%9d%b4 aria-label="PostgreSQL 과 MySQL schema 차이">PostgreSQL 과 MySQL schema 차이</a></li><li><a href=#%ec%9d%b4%ea%b4%80%eb%8c%80%ec%83%81-%ed%99%95%ec%9d%b8 aria-label="이관대상 확인">이관대상 확인</a><ul><li><a href=#database aria-label=database>database</a></li><li><a href=#schema aria-label=schema>schema</a></li><li><a href=#user aria-label=user>user</a></li></ul></li><li><a href=#pg2mysql aria-label=pg2mysql>pg2mysql</a><ul><li><a href=#pg2mysql-%ec%9d%b4%ec%8a%88-%eb%b0%8f-%ec%88%98%ec%a0%95%ec%82%ac%ed%95%ad aria-label="pg2mysql 이슈 및 수정사항">pg2mysql 이슈 및 수정사항</a></li><li><a href=#%ec%82%ac%ec%9a%a9%eb%b0%a9%eb%b2%95 aria-label=사용방법>사용방법</a></li><li><a href=#%eb%8d%b0%ec%9d%b4%ed%84%b0-%ea%b2%80%ec%a6%9d-count-%ed%99%95%ec%9d%b8 aria-label="데이터 검증 (count 확인)">데이터 검증 (count 확인)</a></li></ul></li></ul></div></details></div><div class=post-content><hr><p>MySQL을 PostgreSQL 로 이관하는 방법은 PostgreSQL에서 제공하는 기능인 pgloader 를 사용하면 오브젝트부터 데이터까지 쉽게 이관할 수 있지만<br>반대인 PostgreSQL -> MySQL 은 적당한 툴도 없고, 두 DB의 schema 개념도 달라 사전에 알아둬야 할 점이 많습니다.<br>이번에 이관했던 서비스를 예시로 PostgreSQL => MySQL 이관 방법을 정리해보았습니다.</p><h2 id=postgresql-과-mysql-schema-차이>PostgreSQL 과 MySQL schema 차이<a hidden class=anchor aria-hidden=true href=#postgresql-과-mysql-schema-차이>#</a></h2><p><img loading=lazy src=https://raw.githubusercontent.com/kimdubi/kimdubi.github.io/master/images/psql/p1-5.png alt></p><ul><li>PostgreSQL에서는 테이블의 집합이 schema ( 위 그림에서 public, myschema )</li><li>schema 의 집합이 database ( 위 그림에서 postgres , mydb )</li><li>테이블의 집합 = schema 가 곧 논리 database 인 MySQL과는 개념이 다름</li><li>단 아래와 같이 DB 내에 사용하는 schema 가 단 하나일 땐 PostgreSQL database -> MySQL database 1:1 매핑이 가능함</li></ul><pre><code>amon=# \dn
          List of schemas
        Name        |    Owner
--------------------+--------------
 information_schema | testuser
 pg_catalog         | testuser
 pg_toast           | testuser
 pg_toast_temp_1    | testuser
 public             | testuser
(5 rows)

=&gt; public 을 제외한 나머지 schema는 시스템 관련 스키마, pulic은 모든 schema가 접근 가능한 default schema  

test=# select count(*) from information_schema.tables where table_schema='public';
 count
-------
   100
(1 row)
</code></pre><p>=> 해당 서비스에서는 다른 서비스용 schema 를 생성하지 않고 기본 public schema에 오브젝트를 생성하였음</p><h2 id=이관대상-확인>이관대상 확인<a hidden class=anchor aria-hidden=true href=#이관대상-확인>#</a></h2><h3 id=database>database<a hidden class=anchor aria-hidden=true href=#database>#</a></h3><pre><code>postgres=# \l+
                                                                  List of databases
   Name    |    Owner     | Encoding | Collation  |   Ctype    |         Access privileges         |  Size   | Tablespace |        Description
-----------+--------------+----------+------------+------------+-----------------------------------+---------+------------+---------------------------
 test1      | testuser      | UTF8     | en_US.UTF8 | en_US.UTF8 |                                   | 13 MB   | pg_default |
 test2      | testuser      | UTF8     | en_US.UTF8 | en_US.UTF8 |                                   | 172 MB  | pg_default |
                                                               : 

 template0 | postres        | UTF8     | en_US.UTF8 | en_US.UTF8 | =c/&quot;testuser&quot;                 | 5408 kB | pg_default |
                                                               : &quot;testuser&quot;=CTc/&quot;testuser&quot;
 template1 | postgres       | UTF8     | en_US.UTF8 | en_US.UTF8 | =c/&quot;testuser&quot;                 | 5408 kB | pg_default | default template database
                                                               : &quot;testuser&quot;=CTc/&quot;testuser&quot;
</code></pre><ul><li>이관 대상 PostgreSQL DB 서버 내에 여러 database 들이 존재하는 상황임</li><li>원래 개념대로라면 위의 database 하나하나가 MySQL의 DB instance 로 매핑되지만 아래와 같이 각 database 내에서 schema 를 public schema 하나만 사용하고 있어 PostgreSQL 과 MySQL 1:1 매핑이 가능함</li></ul><h3 id=schema>schema<a hidden class=anchor aria-hidden=true href=#schema>#</a></h3><pre><code>test1=# \dn
          List of schemas
        Name        |    Owner
--------------------+--------------
 information_schema | testuser
 pg_catalog         | testuser
 pg_toast           | testuser
 pg_toast_temp_1    | testuser
 public             | testuser
(5 rows)

test1=# select count(*) from information_schema.tables where table_schema='public';
 count
-------
    100
(1 row)

test1=# \dn
          List of schemas
        Name        |    Owner
--------------------+--------------
 information_schema | testuser
 pg_catalog         | testuser
 pg_toast           | testuser
 pg_toast_temp_1    | testuser
 public             | testuser
(5 rows)


test2=# select count(*) from information_schema.tables where table_schema='public';
 count
-------
    84
(1 row)
</code></pre><h3 id=user>user<a hidden class=anchor aria-hidden=true href=#user>#</a></h3><pre><code>postgres=# select * from pg_catalog.pg_roles;
   rolname    | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcatupdate | rolcanlogin | rolconnlimit | rolpassword | rolvaliduntil | rolconfig |  oid
--------------+----------+------------+---------------+-------------+--------------+-------------+--------------+-------------+---------------+-----------+-------
 testuser     | t        | t          | t             | t           | t            | t           |           -1 | ********    |               |           |    10
.
.
</code></pre><h2 id=pg2mysql>pg2mysql<a hidden class=anchor aria-hidden=true href=#pg2mysql>#</a></h2><p>PostgreSQL dump 파일을 MySQL 쿼리로 변환해주는 툴로 더이상 개발되지 않아 실사용 하기위해 몇가지 부분을 추가하였음</p><h3 id=pg2mysql-이슈-및-수정사항>pg2mysql 이슈 및 수정사항<a hidden class=anchor aria-hidden=true href=#pg2mysql-이슈-및-수정사항>#</a></h3><ul><li>테이블 정의 중 Constraint 부분을 의도적으로 생략하는 이슈<ul><li>foreign , unique constraint 생성 구문 변환되도록 수정</li></ul></li><li>Unique key가 일반인덱스로 생성 되는 이슈<ul><li>Unique key로 생성되도록 수정</li></ul></li><li>engine 변환 구문 오류<ul><li>default로 InnoDB engine 으로 생성하도록 수정</li></ul></li><li>메모리 제한 이슈<ul><li>pg2mysql 프로그램이 사용할 수 있는 최대 메모리 limit 을 512MB로 제한</li></ul></li><li>이관했던 서비스가 테이블, 컬럼을 모두 대문자로 사용하여 생성구문을 모두 대문자로 생성하도록 strtoupper 함수를 추가했음 소문자로 사용하는 경우 strtoupper 함수부분을 제거해야함</li><li>cidr, inet 컬럼 미지원<ul><li>PostgreSQL에는 IP를 표현하는 cidr, inet 컬럼 타입이 있으나 MySQL에는 없음, 이부분은 MySQL에서 big int + inet_aton, inet_ation으로 구현할지 varchar 타입으로 전환할지 결정이 필요하여 수정하지 않았음. 참고로, varchar 로 전환시 order by 결과값이 inet 과는 다름</li></ul></li><li>FK option<ul><li>PostgreSQL에는 DEFERRABLE INITIALLY DEFERRED ( 제약조건을 트랜잭션 종료할 때 검사하는 설정) 같은 MySQL에서는 지원하지 않는 기능이 있음. 경우에 따라 fk 조건을 삭제하거나 트랜잭션 시작시에 set foreign_key_checks = 0 ; 설정을 주도록 개발팀과 협의가 필요하기 때문에 변환과정에서 생략하지 않고 포함하도록함</li></ul></li></ul><h3 id=사용방법>사용방법<a hidden class=anchor aria-hidden=true href=#사용방법>#</a></h3><ul><li>php 설치</li></ul><pre><code>$ php --version
PHP 5.3.3 (cli) (built: Mar 22 2017 12:27:09)
</code></pre><ul><li>첨부파일의 pg2mysql tar 파일을 품</li></ul><pre><code>$ ls -ltr
total 44
-rw-r--r-- 1 irteam irteam 15145 May 26  2006 gpl.txt
-rw-r--r-- 1 irteam irteam  2370 Jul 21  2011 pg2mysql.php
-rw-r--r-- 1 irteam irteam  1534 Jul 21  2011 pg2mysql_cli.php
-rw-r--r-- 1 irteam irteam  2985 Jul 21  2011 README
-rw-rw-r-- 1 irteam irteam 13204 Aug 10 20:44 pg2mysql.inc.php.org
-rw-r--r-- 1 irteam irteam 13235 Aug 10 20:44 pg2mysql.inc.php
</code></pre><ul><li>이관 대상 PostgreSQL dump 파일 준비</li></ul><pre><code>### schema only
pg_dump -p port -U username -S dbname  --format p -f dbname_schema.sql

### data only, insert 구문으로
pg_dump -p port -U username -a dbname --inserts --format p -f dbname_data.sql

### schema+ data
pg_dump -p port -U username  dbname --inserts --format p -f dbname_full.sql
</code></pre><ul><li>MySQL 쿼리로 변환</li></ul><pre><code>php pg2mysql_cli.php dbname_full.sql mysql_dbname.sql 
</code></pre><h3 id=데이터-검증-count-확인>데이터 검증 (count 확인)<a hidden class=anchor aria-hidden=true href=#데이터-검증-count-확인>#</a></h3><ul><li>PostgreSQL</li></ul><pre><code>#!/bin/bash
database=database_name
user=postgres
echo &quot;Database : $database&quot;
PGCOMMAND=&quot; psql -U $user -d $database -At -c \&quot;
            SELECT   table_name
            FROM     information_schema.tables
            WHERE    table_type='BASE TABLE'
            AND      table_schema='public'
            \&quot;&quot;

TABLENAMES=$(export PGPASSWORD=패스워드; eval &quot;$PGCOMMAND&quot;)

for TABLENAME in $TABLENAMES; do
    PGCOMMAND=&quot; psql -U $user -d $database -At -c \&quot;  
                SELECT   '$TABLENAME',  
                         count(*)   
                FROM     $TABLENAME  
                \&quot;&quot;
    eval &quot;$PGCOMMAND&quot;
done
</code></pre><ul><li>MySQL</li></ul><pre><code>#!/bin/bash
database=database_name
for name in `mys $database -B -e &quot;show tables&quot;`;
do
   mys -B --vertical $database -e &quot;select count(*) as $name from $name&quot; | grep -v '^\*' | replace &quot;: &quot; &quot;|&quot;
done
</code></pre><ul><li>index count</li></ul><pre><code># MySQL
select table_name,count(distinct index_name) from information_schema.STATISTICS where index_schema='amon' group by 1 order by 1;

# PostgreSQL
select tablename,count(*) from pg_indexes where schemaname='public' group by 1 order by 1;
</code></pre><p>=> MySQL로 변환되면서 Auto-increment 컬럼이 PK 가 되기 때문에 MySQL 이 인덱스가 더 많을 수 있음</p></div><footer class=post-footer><ul class=post-tags><li><a href=/tags/postgresql/>postgresql</a></li><li><a href=/tags/mysql/>mysql</a></li></ul><nav class=paginav><a class=prev href=/postgresql/pg_replication_wal/><span class=title>« Prev Page</span><br><span>PostgreSQL replication을 위한 WAL 전달과정</span></a>
<a class=next href=/postgresql/pg_slot_issue/><span class=title>Next Page »</span><br><span>pg_replication_slot 사용 시 wal logfile이 계속 쌓일때</span></a></nav></footer><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")
return;var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;var disqus_shortname='kimdubia';dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2024 <a href>kimDuBiA</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById('menu')
menu.scrollLeft=localStorage.getItem("menu-scroll-position");menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft);}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script><script>document.querySelectorAll('pre > code').forEach((codeblock)=>{const container=codeblock.parentNode.parentNode;const copybutton=document.createElement('button');copybutton.classList.add('copy-code');copybutton.innerText='copy';function copyingDone(){copybutton.innerText='copied!';setTimeout(()=>{copybutton.innerText='copy';},2000);}
copybutton.addEventListener('click',(cb)=>{if('clipboard'in navigator){navigator.clipboard.writeText(codeblock.textContent);copyingDone();return;}
const range=document.createRange();range.selectNodeContents(codeblock);const selection=window.getSelection();selection.removeAllRanges();selection.addRange(range);try{document.execCommand('copy');copyingDone();}catch(e){};selection.removeRange(range);});if(container.classList.contains("highlight")){container.appendChild(copybutton);}else if(container.parentNode.firstChild==container){}else if(codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"){codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);}else{codeblock.parentNode.appendChild(copybutton);}});</script></body></html>